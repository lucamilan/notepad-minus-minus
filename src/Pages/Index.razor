@page "/"

<PageTitle>Notepad Minus Minus - Built with Blazor WASM</PageTitle>

@if (_isLoading)
{
    <MudProgressLinear Color="Color.Primary" Size="Size.Large" Indeterminate="true" Style="height: 25px!important;">
        <MudText Typo="Typo.subtitle1" Color="Color.Dark">
            <b>Please be patient, Notepad -- is loading...</b>
        </MudText>
    </MudProgressLinear>
}
else
{
    <MudDynamicTabs Dense="false" Margin="Margin.Dense" Position="Position.Top" @ref="_tabsRef"
    CloseTab="@((panel) => RemoveSheetCallback(panel))" AddTab="AddSheetCallback" @bind-ActivePanelIndex="_index"
    Elevation="3" Rounded="true" ApplyEffectsToContainer="true" PanelClass="px-4 py-6"
    AddIconToolTip="Click here to add a new sheet" CloseIconToolTip="Remove this sheet. All data will be lost"
    PrevIcon="@Icons.Filled.SkipPrevious" NextIcon="@Icons.Filled.SkipNext" Style="height: 90%;">

        @foreach (var sheet in _sheets)
        {
            <MudTabPanel ToolTip="@sheet.Tooltip()" Text="@sheet.Title" Tag="@sheet.Id"
        BadgeColor="@(sheet.IsEmpty()? Color.Surface : Color.Success)" BadgeDot="true">
                @if (CanShowMarkdownPreview(sheet.Id))
                {
                    <MudGrid>
                        <MudItem xs="12" sm="11">
                            @((MarkupString) @sheet.Preview)
                        </MudItem>
                        <MudItem xs="12" sm="1">
                            <MudIconButton Title="Show Editor" Icon="@Icons.Filled.EditNote"
                    OnClick="OnShowMarkdownPreview" />
                        </MudItem>
                    </MudGrid>
                }
                else
                {
                    <MudTextField Adornment="Adornment.End" AdornmentIcon="@Icons.Filled.Preview"
            OnAdornmentClick="OnShowMarkdownPreview" Style="width: 100%; height: 90%;" Lines="25"
            TextChanged="OnTextChangeHandler" T="string" Label="@sheet.CreatedAt.ToString()" Variant="Variant.Outlined"
            @bind-Value="@sheet.Text" />
                }
            </MudTabPanel>
        }

    </MudDynamicTabs>
}
